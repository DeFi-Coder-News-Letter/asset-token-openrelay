package blockhash_test

import (
	"github.com/notegio/openrelay/blockhash"
	"github.com/notegio/openrelay/channels"
	"testing"
	"time"
)

func TestMockChannelGetBlockhash(t *testing.T) {
	publisher, consumerChannel := channels.MockChannel()
	blockHash := blockhash.NewChanneledBlockHash(consumerChannel)
	if value := blockHash.Get(); value != "initializing" {
		t.Errorf("Expected blockHash to be initializing")
	}
	publisher.Publish("{\"hash\": \"0x81248e5939ef967584387a7a20858b8c5115a30c1419eb695f6bc787cf694103\", \"number\": 1, \"bloom\": \"0x00000000000000000000080000800000000000000000000000000000000000000000000000000000000000000000000000000000000004000000080000200000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000010008000000000000000002000000000000000000000000008000000000000\"}")
	time.Sleep(100 * time.Millisecond)
	if value := blockHash.Get(); value != "0x81248e5939ef967584387a7a20858b8c5115a30c1419eb695f6bc787cf694103" {
		t.Errorf("Expected blockHash to be updated value, got '%v'", value)
	}
}
